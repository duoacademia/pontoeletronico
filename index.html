<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ponto ‚Äî Teste de Envio</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --fg:#e5e7eb; --muted:#9aa4b2;
      --brand:#3b82f6; --line:#1f2437; --ok:#22c55e; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--fg)}
    .wrap{max-width:680px;margin:0 auto;padding:16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 6px 0;font-size:20px}
    p.sub{margin:0 0 14px 0;color:var(--muted);font-size:14px}
    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input,button{font:inherit;border-radius:12px;border:1px solid var(--line);background:#0c1426;color:var(--fg)}
    input{padding:12px 14px;width:100%}
    .row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:12px 0}
    .btn{padding:10px;border:1px solid var(--line);border-radius:12px;text-align:center;cursor:pointer}
    .btn[data-active="true"]{border-color:var(--brand);box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    @media (max-width:460px){ .row{grid-template-columns:repeat(2,1fr)} }
    .primary{width:100%;padding:12px 16px;background:var(--brand);border:0;color:white;font-weight:600;margin-top:12px}
    .status{margin-top:12px;font-size:14px}
    .ok{color:var(--ok)} .err{color:var(--err)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Ponto ‚Äî Teste</h1>
      <p class="sub">Vers√£o simplificada para testar o envio ao Apps Script (sem c√¢mera/GPS).</p>

      <label>Nome (opcional)</label>
      <input id="nome" placeholder="Ex.: Ana Silva" autocomplete="name" />

      <label style="margin-top:10px">ID do funcion√°rio</label>
      <input id="funcId" placeholder="Ex.: 123" inputmode="numeric" autocomplete="off" required />

      <label style="margin-top:10px">Tipo de registro</label>
      <div class="row" id="tipoRow">
        <button class="btn" data-tipo="Entrada">Entrada</button>
        <button class="btn" data-tipo="In√≠cio do Intervalo">In√≠cio intervalo</button>
        <button class="btn" data-tipo="Final do Intervalo">Final intervalo</button>
        <button class="btn" data-tipo="Sa√≠da">Sa√≠da</button>
      </div>

      <button id="btnEnviar" class="primary">Enviar teste</button>
      <div id="status" class="status"></div>
    </div>
  </div>

  <script>
    // üîó TROQUE pela sua URL /exec do Apps Script
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzvNQMFBmsUIRwfKfJVQ2ROkFIbYdJ9BrWGw0-STlRTSVL0li61sxlxjFzcwx1jb92-/exec";

    // Pixel transparente (1x1 PNG) para cumprir o 'photo' obrigat√≥rio do backend
    const PIXEL_TRANSPARENTE =
      "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO2v9yQAAAAASUVORK5CYII=";

    const tipoRow = document.getElementById('tipoRow');
    const btns = [...tipoRow.querySelectorAll('.btn')];
    const btnEnviar = document.getElementById('btnEnviar');
    const statusBox = document.getElementById('status');
    const nomeEl = document.getElementById('nome');
    const funcIdEl = document.getElementById('funcId');

    let selectedTipo = null;

    btns.forEach(b=>{
      b.addEventListener('click', ()=>{
        btns.forEach(x=>x.dataset.active = "false");
        b.dataset.active = "true";
        selectedTipo = b.dataset.tipo;
      });
    });

    function setStatus(msg, ok){
      statusBox.textContent = msg;
      statusBox.className = 'status ' + (ok ? 'ok' : 'err');
    }

    async function enviar(){
      try{
        const funcId = (funcIdEl.value || "").trim();
        const nome = (nomeEl.value || "").trim();
        if(!funcId) return setStatus("Informe o ID do funcion√°rio.", false);
        if(!selectedTipo) return setStatus("Selecione o tipo de registro.", false);

        const payload = {
          nome,
          funcionarioId: funcId,
          tipo: selectedTipo,
          latitude: null,
          longitude: null,
          accuracy: null,
          photo: PIXEL_TRANSPARENTE, // üëà s√≥ pra teste
          userAgent: navigator.userAgent
        };

        setStatus("Enviando‚Ä¶", true);
        const res = await fetch(WEB_APP_URL, {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        let out = {};
        try { out = await res.json(); } catch(e){}
        if(res.ok && out.ok){
          setStatus(`OK: registrado √†s ${out.time || 'agora'} (link da selfie: gerado).`, true);
          btns.forEach(x=>x.dataset.active="false"); selectedTipo=null;
        }else{
          throw new Error(out.message || "Falha no servidor.");
        }
      }catch(err){
        setStatus("Erro: " + err.message, false);
      }
    }

    btnEnviar.addEventListener('click', enviar);
  </script>
</body>
</html>
